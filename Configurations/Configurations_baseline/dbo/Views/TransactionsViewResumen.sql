
CREATE VIEW dbo.TransactionsViewResumen AS
select
t.Id as Id,
t.CreateTimestamp as CreateTimestamp,
t.UpdateTimestamp as UpdateTimestamp,
t.TransportTimestamp as TransportTimestamp,
t.RequestInputTimestamp as RequestInputTimestamp,
t.RequestOutputTimestamp as RequestOutputTimestamp,
t.AnswerInputTimestamp as AnswerInputTimestamp,
t.AnswerOutputTimestamp as AnswerOutputTimestamp,
t.DeviceIdentification as DeviceIdentification,
t.LocationIdentification as LocationIdentification,
t.ServiceName as ServiceName,
t.OperationName as OperationName,
t.SequenceNumber as SequenceNumber,
t.Status as Status,
t.UserIdentification as UserIdentification,
t.ProviderIdentification as ProviderIdentification,
t.ProviderTransactionID as ProviderTransactionID,
t.DeviceTransactionID as DeviceTransactionID,
t.SyncStatus as SyncStatus,
t.SyncTimestamp as SyncTimestamp,
t.ProductIdentification as ProductIdentification,
t.RetrievalReferenceNumber as RetrievalReferenceNumber,
t.FacilitiesPayments as FacilitiesPayments,
t.FacilitiesType as FacilitiesType,
t.CurrencyCode as CurrencyCode,
t.Amount as Amount,
t.FeeAmount as FeeAmount,
t.TaxAmount as TaxAmount,
t.ComissionAmount as ComissionAmount,
t.ServiceChargeAmount as ServiceChargeAmount,
t.MerchantIdentification as MerchantIdentification,
t.ProviderDeviceIdentification as ProviderDeviceIdentification,
t.ReverseStatus as ReverseStatus,
t.ReverseTimestamp as ReverseTimestamp,
t.VoidStatus as VoidStatus,
t.VoidTimestamp as VoidTimestamp,
t.VoidUserIdentification as VoidUserIdentification,
t.RefundStatus as RefundStatus,
t.RefundTimestamp as RefundTimestamp,
t.RefundUserIdentification as RefundUserIdentification,
t.RefundAmount as RefundAmount,
t.CloseStatus as CloseStatus,
t.CloseTimestamp as CloseTimestamp,
t.CloseUserIdentification as CloseUserIdentification,
t.SettlementStatus as SettlementStatus,
t.SettlementTimestamp as SettlementTimestamp,
t.SettlementUserIdentification as SettlementUserIdentification,
t.SettlementAmount as SettlementAmount,
t.SettlementTransactionId as SettlementTransactionId,
t.RevisionStatus as RevisionStatus,
t.RevisionTimestamp as RevisionTimestamp,
t.RevisionReason as RevisionReason,
t.RevisionSource as RevisionSource,
t.BatchNumber as BatchNumber,
t.TicketNumber as TicketNumber,
t.ProviderBatchNumber as ProviderBatchNumber,
t.ProviderTicketNumber as ProviderTicketNumber,
t.ProviderTraceNumber as ProviderTraceNumber,
t.ProviderAuthorizationCode as ProviderAuthorizationCode,
t.CustomerIdentification as CustomerIdentification,
t.CredentialInputMode as CredentialInputMode,
t.CredentialMask as CredentialMask,
t.CredentialEncrypted as CredentialEncrypted,
t.CredentialExpDate as CredentialExpDate,
t.CredentialCardHash as CredentialCardHash,
t.CredentialHolderName as CredentialHolderName,
t.CredentialAddress as CredentialAddress,
t.CredentialDocumentType as CredentialDocumentType,
t.CredentialDocumentNumber as CredentialDocumentNumber,
t.CredentialEmailAddress as CredentialEmailAddress,
t.DeviceFingerprint as DeviceFingerprint,
t.ResultCode as ResultCode,
t.ResultMessage as ResultMessage,
t.ProviderResultCode as ProviderResultCode,
t.ProviderResultMessage as ProviderResultMessage,
t.Channel as Channel,
t.CaptureAddress as CaptureAddress,
t.CaptureTimestamp as CaptureTimestamp,
t.RequestAddress as RequestAddress,
t.RequestTimestamp as RequestTimestamp,
t.AnswerAddress as AnswerAddress,
t.AnswerTimestamp as AnswerTimestamp,
t.RedirectURLOK as RedirectURLOK,
t.RedirectURLError as RedirectURLError,
t.CredentialBirthday as CredentialBirthday,
t.BillHolderName as BillHolderName,
t.BillHolderDocumentType as BillHolderDocumentType,
t.BillHolderDocumentNumber as BillHolderDocumentNumber,
t.ProviderCustomerCode as ProviderCustomerCode,
t.ProviderCustomerAdditionalCode as ProviderCustomerAdditionalCode,
t.ChargeLatePaymentAmount as ChargeLatePaymentAmount,
t.DifferenceBetweenFirstExpiration as DifferenceBetweenFirstExpiration,
t.DaysAfterFirstExpiration as DaysAfterFirstExpiration,
t.CouponExpirationDate as CouponExpirationDate,
t.InvoiceExpirationDate as InvoiceExpirationDate,
t.PaymentBarCode as PaymentBarCode,
t.InvoiceBarCode as InvoiceBarCode,
t.LiquidationStatus as LiquidationStatus,
t.LiquidationTimestamp as LiquidationTimestamp,
t.ReconciliationStatus as ReconciliationStatus,
t.ReconciliationTimestamp as ReconciliationTimestamp,
t.AvailableStatus as AvailableStatus,
t.AvailableTimestamp as AvailableTimestamp,
t.AvailableAmount as AvailableAmount,
t.BillingStatus as BillingStatus,
t.BillingTimestamp as BillingTimestamp,
t.ProcessorResultCode as ProcessorResultCode,
t.ProcessorResultMessage as ProcessorResultMessage,
t.ButtonId as ButtonId,
t.ButtonExternalId as ButtonExternalId,
t.ButtonMinimumAmount as ButtonMinimumAmount,
t.ButtonMaximumAmount as ButtonMaximumAmount,
t.SaleConcept as SaleConcept,
t.MerchantActivityCode as MerchantActivityCode,
t.ChargebackStatus as ChargebackStatus,
t.ChargebackTimestamp as ChargebackTimestamp,
t.ChargebackReason as ChargebackReason,
t.CashoutStatus as CashoutStatus,
t.CashoutTimestamp as CashoutTimestamp,
t.FilingDeadline as FilingDeadline,
t.PaymentTimestamp as PaymentTimestamp,
t.PaymentStatus as PaymentStatus,
t.PaymentDeadline as PaymentDeadline,
t.CouponStatus as CouponStatus,
t.CouponDaysBetweenExpDates as CouponDaysBetweenExpDates,
t.CouponValidityDays as CouponValidityDays,
t.CouponFee as CouponFee,
t.CouponSecondExpirationDate as CouponSecondExpirationDate,
t.CouponClientCode as CouponClientCode,
t.CouponSubscriber as CouponSubscriber,
t.CouponOperationId as CouponOperationId,
t.OriginalOperationId as OriginalOperationId,
t.TransactionStatus as TransactionStatus,
t.ProductType as ProductType,
t.BankIdentification as BankIdentification,
t.BuyerAccountIdentification as BuyerAccountIdentification,
t.PrivateRequestKey as PrivateRequestKey,
t.PublicRequestKey as PublicRequestKey,
t.PrivateAnswerKey as PrivateAnswerKey,
t.PublicAnswerKey as PublicAnswerKey,
t.PublicIdentification as PublicIdentification,
t.id_medio_pago_cuenta as id_medio_pago_cuenta,
t.AmountBuyer as AmountBuyer,
t.FeeAmountBuyer as FeeAmountBuyer,
t.TaxAmountBuyer as TaxAmountBuyer,
t.AdditionalData as AdditionalData,
t.PromotionIdentification as PromotionIdentification,
t.id_tipo_concepto_boton as id_tipo_concepto_boton,
usu_cta.eMail as VendedorEmailAddress
from Transactions.dbo.transactions t
left join dbo.Usuario_Cuenta usu_cta
on usu_cta.id_cuenta = t.LocationIdentification

union all

select
(CAST(a.id_ajuste AS VARCHAR)) as Id,
a.fecha_alta as CreateTimestamp,
NULL as UpdateTimestamp,
NULL as TransportTimestamp,
NULL as RequestInputTimestamp,
NULL as RequestOutputTimestamp,
NULL as AnswerInputTimestamp,
NULL as AnswerOutputTimestamp,
NULL as DeviceIdentification,
a.id_cuenta as LocationIdentification,
NULL as ServiceName,
'Ajuste' as OperationName,
NULL as SequenceNumber,
e.id_estado as Status,
NULL as UserIdentification,
NULL as ProviderIdentification,
(cast (a.id_ajuste AS varchar)) as ProviderTransactionID,
NULL as DeviceTransactionID,
NULL as SyncStatus,
NULL as SyncTimestamp,
NULL as ProductIdentification,
NULL as RetrievalReferenceNumber,
NULL as FacilitiesPayments,
NULL as FacilitiesType,
NULL as CurrencyCode,
a.monto_neto as Amount,
NULL as FeeAmount,
NULL as TaxAmount,
NULL as ComissionAmount,
NULL as ServiceChargeAmount,
NULL as MerchantIdentification,
NULL as ProviderDeviceIdentification,
NULL as ReverseStatus,
NULL as ReverseTimestamp,
NULL as VoidStatus,
NULL as VoidTimestamp,
NULL as VoidUserIdentification,
NULL as RefundStatus,
NULL as RefundTimestamp,
NULL as RefundUserIdentification,
NULL as RefundAmount,
NULL as CloseStatus,
NULL as CloseTimestamp,
NULL as CloseUserIdentification,
NULL as SettlementStatus,
NULL as SettlementTimestamp,
NULL as SettlementUserIdentification,
NULL as SettlementAmount,
NULL as SettlementTransactionId,
NULL as RevisionStatus,
NULL as RevisionTimestamp,
NULL as RevisionReason,
NULL as RevisionSource,
NULL as BatchNumber,
NULL as TicketNumber,
NULL as ProviderBatchNumber,
NULL as ProviderTicketNumber,
NULL as ProviderTraceNumber,
NULL as ProviderAuthorizationCode,
NULL as CustomerIdentification,
NULL as CredentialInputMode,
NULL as CredentialMask,
NULL as CredentialEncrypted,
NULL as CredentialExpDate,
NULL as CredentialCardHash,
(CAST(a.id_ajuste AS VARCHAR)) as CredentialHolderName,
NULL as CredentialAddress,
NULL as CredentialDocumentType,
NULL as CredentialDocumentNumber,
NULL as CredentialEmailAddress,
NULL as DeviceFingerprint,
-1 as ResultCode,
NULL as ResultMessage,
NULL as ProviderResultCode,
NULL as ProviderResultMessage,
NULL as Channel,
NULL as CaptureAddress,
NULL as CaptureTimestamp,
NULL as RequestAddress,
NULL as RequestTimestamp,
NULL as AnswerAddress,
NULL as AnswerTimestamp,
NULL as RedirectURLOK,
NULL as RedirectURLError,
NULL as CredentialBirthday,
NULL as BillHolderName,
NULL as BillHolderDocumentType,
NULL as BillHolderDocumentNumber,
NULL as ProviderCustomerCode,
NULL as ProviderCustomerAdditionalCode,
NULL as ChargeLatePaymentAmount,
NULL as DifferenceBetweenFirstExpiration,
NULL as DaysAfterFirstExpiration,
NULL as CouponExpirationDate,
NULL as InvoiceExpirationDate,
NULL as PaymentBarCode,
NULL as InvoiceBarCode,
NULL as LiquidationStatus,
NULL as LiquidationTimestamp,
NULL as ReconciliationStatus,
NULL as ReconciliationTimestamp,
NULL as AvailableStatus,
NULL as AvailableTimestamp,
NULL as AvailableAmount,
NULL as BillingStatus,
NULL as BillingTimestamp,
NULL as ProcessorResultCode,
NULL as ProcessorResultMessage,
NULL as ButtonId,
NULL as ButtonExternalId,
NULL as ButtonMinimumAmount,
NULL as ButtonMaximumAmount,
ma.descripcion as SaleConcept,
NULL as MerchantActivityCode,
NULL as ChargebackStatus,
NULL as ChargebackTimestamp,
NULL as ChargebackReason,
NULL as CashoutStatus,
NULL as CashoutTimestamp,
NULL as FilingDeadline,
NULL as PaymentTimestamp,
NULL as PaymentStatus,
NULL as PaymentDeadline,
NULL as CouponStatus,
NULL as CouponDaysBetweenExpDates,
NULL as CouponValidityDays,
NULL as CouponFee,
NULL as CouponSecondExpirationDate,
NULL as CouponClientCode,
NULL as CouponSubscriber,
NULL as CouponOperationId,
NULL as OriginalOperationId,
e.nombre as TransactionStatus,
NULL as ProductType,
NULL as BankIdentification,
NULL as BuyerAccountIdentification,
NULL as PrivateRequestKey,
NULL as PublicRequestKey,
NULL as PrivateAnswerKey,
NULL as PublicAnswerKey,
NULL as PublicIdentification,
NULL as id_medio_pago_cuenta,
NULL as AmountBuyer,
NULL as FeeAmountBuyer,
NULL as TaxAmountBuyer,
NULL as AdditionalData,
NULL as PromotionIdentification,
NULL as id_tipo_concepto_boton,
NULL as VendedorEmailAddress

from dbo.Ajuste a
left join dbo.Estado e
on e.id_estado = a.estado_ajuste
left join dbo.Motivo_Ajuste ma
on a.id_motivo_ajuste = ma.id_motivo_ajuste